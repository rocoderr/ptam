# view/ — Website + 3D Viewer 开发方案（草案）

本目录将作为一个**纯静态网站**（Static Site），用原生 `HTML/CSS/JS` 实现两件事：

1. 读者在浏览器阅读全书（中英文两版）。
2. 用 3D 交互坐标系展示“政治三轴模型”中的定位（点或区间），并支持多选对比与解释文本展示。

本文档是开发用的 `AGENTS.md`：约定目录结构、数据格式、脚本与同步机制。它不修改论文正文写作方式。

---

## 0. 约束与默认选择

- 默认不引入框架（React/Vue 等），只用原生 JS。
- 允许使用 3D 库，但要**可离线**：把依赖文件放进仓库（vendor），避免运行时 CDN 依赖。
- 网站发布目标优先选“静态托管”：`GitHub Pages` / `Netlify` / 本地 `file://` 打开都应能用（`file://` 下 fetch 可能受限，建议提供本地静态服务器运行方式）。

---

## 1) 功能一：把全书变成可阅读的网站

### 1.1 现状与目标

现状：你在根目录用两个大文件写作：

- 中文：`../政治三轴模型--政治“左、右”的三大本体轴与覆盖变量分析框架.md`
- 英文：`../Political_Triple-Axis_Model.md`

目标：生成一组 HTML 页面（按章节拆分），并提供：

- 左侧目录树（或目录列表），点击跳转章节
- 正文阅读（含标题层级、段落、列表、表格、脚注/引用若有）
- 章节内锚点（heading anchors）
- 中英切换（同一章的中英版本互跳）或者选择中英对照阅读

### 1.2 “拆分成多个 HTML”这个方案好不好？

结论：**可行，且适合静态托管**；但“拆分规则”和“目录稳定性”是关键。

优点（为什么可行）：

- 读者体验好：每章一个页面，加载快，浏览器前进/后退行为直觉。
- 易于做目录与锚点：章节 URL 稳定，可以在章节间互链。
- 适合后续加搜索：可以做“全站索引 JSON”或每章索引。

风险/成本（需要提前定好）：

- 拆分规则必须稳定，否则更新正文会导致 URL 改变、外链失效。
- Markdown → HTML 的渲染要一致（表格/代码块/脚注等扩展语法处理）。

### 1.3 更好的同步机制（推荐优先级）

这里的“同步机制”指：你更新大 Markdown 后，网站如何更新且保持 URL 稳定。

推荐从简到强：

**方案 A（最简）：浏览器端渲染一个大 Markdown**

- 网站只保存原始 `.md`，浏览器用 JS 把 Markdown 渲染成 HTML。
- 省去“拆分脚本”，写作与展示天然同步。
- 缺点：首屏可能慢；目录、章节 URL、SEO 都比较弱；`file://` 打开时 `fetch` 易受限制。

**方案 B（推荐默认）：构建时拆分 + 生成静态 HTML**

- 写作仍在一个大文件；每次更新后运行脚本生成 `view/site/` 下的静态 HTML。
- 兼顾体验与可控性；适合静态托管；对读者最稳定。
- 重点是：用 `TableOfContents.md` 作为“稳定的章节 ID 来源”，不要仅靠标题文本猜测。

**方案 C（更强但更重）：改为多文件写作，再汇总**

- 写作阶段按目录拆成小文件（更贴近网页形态），输出时可合并成大文件（用于论文发布或单文件备份）。
- 优点：章节内容更易管理、并行修改更舒服、拆分更自然。
- 成本：需要管理大量文件；跨章节检索/重构依赖良好的命名与工具；你当前“单文件写作更简单”的优势会被削弱。

我的建议（在你现阶段的偏好下）：

- 先做方案 B：**保持单文件写作**，用脚本拆分出网站。
- 等到“章节频繁并行改动”或“多人协作/重排结构频繁”时，再考虑方案 C。

### 1.4 拆分脚本：规则与产物（方案 B）

**输入**

- `../TableOfContents.md`：作为章节结构的权威来源（生成目录树、稳定 slug、章节排序）。
- `../政治三轴模型--政治“左、右”的三大本体轴与覆盖变量分析框架.md`
- `../Political_Triple-Axis_Model.md`

**输出目录（建议）**

- `view/site/`
  - `zh/`：中文站
  - `en/`：英文站
  - `assets/`：CSS/JS/字体/图片
  - `search/`：可选，搜索索引 JSON

**输出文件（建议）**

- `view/site/index.html`：入口，默认跳转 `zh/` 或提供语言选择。
- `view/site/zh/index.html`：中文目录页
- `view/site/zh/<chapter-id>.html`：章节页（chapter-id 来自目录/标题）
- `view/site/en/<chapter-id>.html`：英文对应章节页
- `view/site/manifest.json`：可选（PWA/图标）

**章节 ID（最关键的稳定性约定）**

- 章节文件名不要从“标题文本”直接生成（标题一改，URL 就变）。
- 建议：从 `TableOfContents.md` 中的编号/路径生成稳定 `chapter-id`（例如 `ch06-ideology-table` 这种），并允许在目录文件里显式指定（后续需要时再加语法）。

**渲染方式**

- 脚本在构建时把 Markdown 渲染成 HTML。
- 纯离线依赖建议：
  - 选择一个稳定的 Markdown 渲染器（Node 或 Python 都行），并把依赖 vendoring/锁定版本。
  - 若暂时不想引入依赖：先做“最小可用版”——用浏览器端渲染（方案 A）跑通，再升级到构建时渲染（方案 B）。

**增量更新（可选）**

- 把输入文件内容做 hash（或按 mtime），hash 不变则跳过重建，提升迭代速度。

---

## 2) 功能二：3D 三轴坐标系互动展示

### 2.1 选择 3D 库

默认建议：`three.js`（Three.js）

- 生态成熟，交互控制（OrbitControls）与射线拾取（Raycaster）现成。
- 可以只引入必要文件，离线 vendoring。

备选：`Babylon.js`（更偏工程化），或纯 WebGL（成本高，不建议）。

### 2.2 交互需求 → 具体实现映射

你要的交互（旋转、缩放、平移，鼠标/触摸都支持）：

- 旋转/缩放/平移：`OrbitControls`（支持鼠标与触控手势）
- hover / click / long-press：
  - 鼠标：mousemove + Raycaster
  - 触控：pointer events；long-press 用计时器（例如 350–500ms）触发拾取

### 2.3 坐标系与可视化对象

坐标范围（按论文约定）：每轴 `[-5, +5]`，展示为一个立方体空间。

对象类型：

- **点（Point）**：某意识形态在三轴上的“代表性位置”（如果你愿意给出）
- **区间/盒（Box / Interval）**：更常见：每轴一个范围 `[min, max]`，三轴组合成一个长方体（axis-aligned box）

渲染建议：

- 轴线 + 网格（可开关）
- 区间用半透明色块（透明度 0.25–0.45），边框略亮以便识别
- 多个意识形态：颜色表固定（避免每次刷新颜色变化）

### 2.4 数据格式（建议先手工 JSON，后续再自动提取）

建议在 `view/data/` 维护一份“结构化数据”，而不是直接从正文第六章表格硬解析（硬解析容易被你改表格格式打断）。

示例（伪结构）：

- `view/data/ideologies.zh.json`
- `view/data/ideologies.en.json`

每个条目（字段建议）：

- `id`：稳定 ID（用于 URL、颜色映射、跨语言对应）
- `name`：显示名
- `color`：十六进制
- `range`：
  - `x`: `[min, max]`（经济秩序轴 Economic Order Axis）
  - `y`: `[min, max]`（自由边界轴 Liberty Boundary Axis）
  - `z`: `[min, max]`（权利本体轴 Rights Ontology Axis）
- `explain`：
  - `x` / `y` / `z`：每轴 3–8 句的**解释文本**（“为什么在这个区间”）
  - 可选 `notes`：补充边界/反例
- `sources`（可选）：对应正文的章节/段落定位（不是引用对话记录）

后续想“从第六章表格自动生成 JSON”，可以再加一个脚本专门做抽取；但第一阶段建议先把数据手工固定下来，先把交互体验做对。

### 2.5 UI 布局（与你的设想对齐）

页面建议：`view/site/axis/`（或 `view/site/tools/axis.html`）

布局三块：

1. 左侧：意识形态列表（全选/清空/搜索），checkbox 多选
2. 中间：3D 画布（Canvas）
3. 右侧或浮层：信息面板（名称 + 三轴范围 + 解释文本）

交互细节：

- hover/click/long-press 某色块 → 高亮边框 + 信息面板显示对应条目
- 信息面板同时显示：
  - `X/Y/Z` 的范围值（例如 `X: [-2, 0]`）
  - 每轴解释：用短段落或要点（不做评价，只解释结构原因）
- 输入自定义坐标：
  - 方式 1：输入 `x,y,z`（点）
  - 方式 2：输入每轴 `[min,max]`（区间）
  - 显示为“临时对象”（颜色固定，例如灰色），并可一键复制成 JSON 模板

### 2.6 “输入意识形态名字 → 自动分析三轴定位”现在能实现吗？

结论：**技术上能做原型，但难以保证可重复与可审计**，并且需要额外依赖（大模型 + 提示词 + 你的模型背景资料）。

如果要做，建议把它定位为“实验功能”，并加两层约束：

- 输出必须包含：
  - 三轴区间
  - 每轴理由（可追溯到你模型的判据）
  - 明确的“不确定项/需要作者确认项”
- 支持“作者审阅后保存”：把 LLM 输出转成可编辑 JSON，最终以人工确认为准

在不引入网络/模型调用的前提下，本项目第一阶段先不做自动分析，只做“展示 + 手工数据”。

---

## 3) 建议的目录结构（第一阶段）

`view/`

- `AGENTS.md`（本文件）
- `site/`（构建产物：静态站点）
- `src/`（源代码：页面模板、JS、CSS）
- `data/`（意识形态/主张的结构化数据 JSON）
- `scripts/`（构建脚本：Markdown → HTML 拆分、生成目录/索引）
- `vendor/`（离线第三方库：three.js 等）

---

## 4) 下一步：需要你确认的关键问题（避免我擅自假设）

已确认（你的回答）：

1. 发布方式：`GitHub Pages`。
2. 拆分粒度：按“章（二级）+ 节（三级）”拆分，左侧目录树与 `TableOfContents.md` 结构一致。
3. 中英文：严格一一对应（同一套 `chapter-id` / `sec-id`）；英文版必须对齐。
4. 第六章数据：先写解析器从正文表格抽取到固定位置，你再手工更正。

因此，本目录的默认落地方案调整为：

- 站点实现：**纯静态 HTML**（GitHub Pages 只负责托管，不做构建）。拆分脚本使用 `Node.js`（`view/scripts/split_books.mjs`），将 Markdown 拆分并生成可直接访问的 HTML 页面与目录数据。
- 拆分依据：以正文中显式的 `<a id="sec-..."></a>` 作为分段锚点，以 `../TableOfContents.md` 作为结构与顺序的权威来源。
- 3D 依赖：第一阶段允许先用 CDN 验证交互；第二阶段再 vendoring 到 `view/vendor/` 以获得可离线与版本锁定。
